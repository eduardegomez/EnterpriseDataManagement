{% extends "admin/base_site.html" %}
{% load i18n %}
{% load static %}
{% load fontawesome_5 %}
{% fontawesome_5_static %}

{% block content %}
<style>
.centrado {
  margin: 1rem;
  padding: 1rem;
}
</style>
<body style="background-color: #efefef;">
<div class="centrado">
    <legend style="margin-top: 20px; text-align: center;">
        <i class="fas fa-users"></i> {% trans 'Tipos de Contacto' %}
    </legend>
    <hr/>
    <div class="col-md-12" style="display: flex;">
        <div class="col-md-1"></div>
        <div class="col-md-1">
            <a id="btn-back" class="btn btn-outline-secondary" href="{% url 'fevama:projects_index' %}">
                {% fa5_icon 'long-arrow-alt-left' 'fas' %} {% trans 'Volver' %}
            </a>
        </div>
        <div class="col-md-2">
            <a id="btn-back" class="btn btn-outline-secondary" href="{% url 'fevama:typeofcontact_create' %}">
                {% fa5_icon 'plus' 'fas' %} {% trans 'Crear nuevo tipo' %}
            </a>
        </div>
    </div>
    <table class="table table-striped table-hover" style="margin-top: 20px; text-align: center;">
        <thead>
            <tr style="background-color: rgb(133, 172, 172);">
                <td><b>ID</b></td>
                <td><b>TIPO</b></td>
                <td><b>ACCIONES</b></td>
            </tr>
        </thead>
        <tbody id="tbody">
            {% if object_list %}
                {% for typeofcontact in object_list %}
                <tr>
                    <td>{{typeofcontact.id}}</td>
                    <td>{{typeofcontact.name}}</td>
                    <td>
                        <a class="btn btn-primary btn-sm" href="{% url 'fevama:typeofcontact_modify' typeofcontact.id %}"> EDITAR </a>
                        <a id="btn-delete" class="btn btn-danger btn-sm" onclick="create({{typeofcontact.id}})"> ELIMINAR </a>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
    <div class="centrado" style="display: flex; justify-content: center;">
        <a id="btn-all" class="btn btn-outline-secondary" onclick="showmore()">
            {% fa5_icon 'plus' 'fas' %} {% trans 'Mostrar más' %}
        </a>
    </div>
</div>
</body>
<script>
    function create(id){
        if(confirm('{% trans "Estás seguro de eliminar este tipo de contacto? Se eliminarán todos los contactos que tengan este tipo" %}'))
        {
            //document.getElementById("btn-delete").className = "btn btn-warning btn btn-block btnBootstrapping";
            //document.getElementById("btn-delete").innerHTML="<i class='fa fa-spinner fa-spin'></i>&nbsp;{% trans 'ELIMINANDO' %}";
            $.ajax({
                url: '{% url "fevama:typeofcontact_deleteItem" %}',
                data:  {
                    'data': id,
                },
                dataType: 'json',
                success: function (data) {
                    location.reload(true)
                },
                error: function (data) {
                    document.getElementById("btn-delete").className = "btn btn-danger btn btn-block btnBootstrapping";
                    document.getElementById("btn-delete").innerHTML="ERROR"; 
                    location.reload(true)
                },
            });
        }
    }
    function showmore(){
        $.ajax({
                url: '{% url "fevama:typeofcontact_showAll" %}',
                data:  {},
                dataType: 'json',
                success: function (data) {
                    console.log(data["data"]);
                    data = data["data"]
                    for (var i=0; i< data.length; i++){
                        var button = "<a id=edit"+ i + "> EDITAR </a>";
                        var button2 = "<a id=eliminar"+ i + "> ELIMINAR </a>";
                        console.log(button)
                        $('#tbody').append("<tr><td>" + data[i].id + "</td><td>" + data[i].type +"</td><td>" + 
                            button + " " + button2
                            );
                        check= "edit"+i;
                        check1= "eliminar"+i;
                        var edit_button = document.getElementById(check);
                        edit_button.classList.add("btn", "btn-primary", "btn-sm");
                        delete_button = document.getElementById(check1);
                        delete_button.classList.add("btn", "btn-danger", "btn-sm");
                        //delete_button.onclick = create(data[i].id);

                    }
                    document.getElementById("btn-all").style = "display:none"
                    
                },
                error: function (data) {
                    console.log(data)
                    document.getElementById("btn-delete").className = "btn btn-danger btn btn-block btnBootstrapping";
                    document.getElementById("btn-delete").innerHTML="ERROR"; 
                    //location.reload(true)
                },
            });  
    }
</script>
{% endblock %}