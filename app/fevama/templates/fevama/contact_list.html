{% extends "admin/base_site.html" %}
{% load i18n %}
{% load static %}
{% load fontawesome_5 %}
{% fontawesome_5_static %}

{% block content %}
<style>
.centrado {
  margin: 1rem;
  padding: 1rem;
}
</style>
<body style="background-color: #efefef;">
<div class="centrado">
    <legend style="margin-top: 20px; text-align: center;">
        <i class="fas fa-address-book"></i> {% trans 'Contactos' %}
    </legend>
    <hr/>
    <div class="col-md-12" style="display: flex;">
        <div class="col-md-1"></div>
        <div class="col-md-1">
            <a id="btn-back" class="btn btn-outline-secondary" href="{% url 'fevama:projects_index' %}">
                {% fa5_icon 'long-arrow-alt-left' 'fas' %} {% trans 'Volver' %}
            </a>
        </div>
        <div class="col-md-2">
            <a id="btn-back" class="btn btn-outline-secondary" href="{% url 'fevama:contact_create' %}">
                {% fa5_icon 'plus' 'fas' %} {% trans 'Crear nuevo contacto' %}
            </a>
        </div>
    </div>
    <table class="table table-striped table-hover" style="margin-top: 20px;text-align: center;">
        <thead>
            <tr style="background-color: rgb(133, 172, 172);">
                <td><b>ID</b></td>
                <td><b>NOMBRE</b></td>
                <td><b>EMAIL</b></td>
                <td><b>EMPRESA</b></td>
                <td><b>TIPO</b></td>
                <td><b>ACCIÓN</b></td>
            </tr>
        </thead>
        <tbody>
            {% if object_list %}
                {% for contact in object_list %}
                <tr>
                    <td>{{contact.id}}</td>
                    <td>{{contact.name}}</td>
                    <td>{{contact.email}}</td>
                    <td>{{contact.empresa.name}}</td>
                    <td>{{contact.type.name}}</td>
                    <td>
                        <a class="btn btn-primary btn-sm" href="{% url 'fevama:contact_modify' contact.id %}"> EDITAR </a>
                        <a id="btn-delete" class="btn btn-danger btn-sm" onclick="create({{contact.id}})"> ELIMINAR </a>
                    </td>
                </tr>
                {% endfor %}
            {% endif %}
        </tbody>
    </table>
</div>
</body>
<script>
    function create(id){
        if(confirm('{% trans "Estás seguro de eliminar este contacto?" %}'))
        {
            //document.getElementById("btn-delete").className = "btn btn-warning btn btn-block btnBootstrapping";
            //document.getElementById("btn-delete").innerHTML="<i class='fa fa-spinner fa-spin'></i>&nbsp;{% trans 'ELIMINANDO' %}";
            $.ajax({
                url: '{% url "fevama:contact_deleteItem" %}',
                data:  {
                    'data': id,
                },
                dataType: 'json',
                success: function (data) {
                    location.reload(true)
                },
                error: function (data) {
                    document.getElementById("btn-delete").className = "btn btn-danger btn btn-block btnBootstrapping";
                    document.getElementById("btn-delete").innerHTML="ERROR"; 
                    location.reload(true)
                },
            });
        }
    }
</script>
{% endblock %}